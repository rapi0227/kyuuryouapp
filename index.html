<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>çµ¦æ–™è¨ˆç®—ã‚¢ãƒ—ãƒª</title>
<style>
body { font-family: sans-serif; background:#ffe6f0; padding:20px; }
table { width:100%; border-collapse: collapse; background:#fff; }
th, td { border:1px solid #ccc; padding:6px; text-align:center; }
th { background:#ffb6c1; }
input[type="number"] { width:70px; }
button { padding:10px 20px; margin:10px 0; }
.summary { background:#fff; padding:15px; margin-top:20px; }
</style>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ff69b4">
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</head>
<body>

<h2>ğŸ¸ çµ¦æ–™è¨ˆç®—ã‚¢ãƒ—ãƒª</h2>

<button onclick="addRow()">ï¼‹ æ—¥ä»˜è¿½åŠ </button>

<table id="salaryTable">
<tr>
<th>æ—¥ä»˜</th>
<th>æ™‚é–“</th>
<th>æ™‚çµ¦</th>
<th>ãƒ‰ãƒªãƒ³ã‚¯</th>
<th>å ´å†…</th>
<th>æœ¬æŒ‡å</th>
<th>åŒä¼´å£²ä¸Š</th>
<th>ãƒ˜ã‚¢ãƒ¡</th>
<th>æ—¥æ‰•ã„</th>
<th>å‰Šé™¤</th>
</tr>
</table>

<div class="summary" id="summary"></div>

<script>
const DRINK_BACK = 200;
const INHOUSE_BACK = 200;
const MAIN_BACK = 500;
const ACCOMPANY_RATE = 0.1;
const TAX_RATE = 0.12;
const HAIR_COST = 500;
const WELFARE_COST = 500;
const DAILY_PAY = 5000;

function addRow(data = {}) {
  const table = document.getElementById("salaryTable");
  const row = table.insertRow();

  row.innerHTML = `
  <td><input type="date" value="${data.date || ''}"></td>
  <td><input type="number" value="${data.hours || 0}"></td>
  <td><input type="number" value="${data.wage || 2500}"></td>
  <td><input type="number" value="${data.drink || 0}"></td>
  <td><input type="number" value="${data.inhouse || 0}"></td>
  <td><input type="number" value="${data.main || 0}"></td>
  <td><input type="number" value="${data.accompany || 0}"></td>
  <td><input type="checkbox" ${data.hair ? 'checked' : ''}></td>
  <td><input type="checkbox" ${data.daily ? 'checked' : ''}></td>
  <td><button onclick="deleteRow(this)">Ã—</button></td>
  `;

  save();
}

function deleteRow(btn) {
  btn.closest("tr").remove();
  save();
}

function calculate() {
  let totalHours = 0;
  let totalBack = 0;
  let totalDeduction = 0;
  let totalPay = 0;

  const rows = [...document.querySelectorAll("#salaryTable tr")].slice(1);

  rows.forEach(r => {
    const i = r.querySelectorAll("input");
    const hours = +i[1].value;
    const wage = +i[2].value;

    const base = hours * wage;
    const back =
      i[3].value * DRINK_BACK +
      i[4].value * INHOUSE_BACK +
      i[5].value * MAIN_BACK +
      i[6].value * ACCOMPANY_RATE;

    let deduction = base * TAX_RATE + WELFARE_COST;
    if (i[7].checked) deduction += HAIR_COST;
    if (i[8].checked) deduction += DAILY_PAY;

    totalHours += hours;
    totalBack += back;
    totalDeduction += deduction;
    totalPay += base + back - deduction;
  });

  document.getElementById("summary").innerHTML = `
  <h3>ğŸ“Š æœˆé–“é›†è¨ˆ</h3>
  ç·åŠ´åƒæ™‚é–“ï¼š${totalHours} æ™‚é–“<br>
  ãƒãƒƒã‚¯åˆè¨ˆï¼šÂ¥${totalBack.toLocaleString()}<br>
  å¼•ã‹ã‚Œã‚‚ã®åˆè¨ˆï¼šÂ¥${totalDeduction.toLocaleString()}<br>
  <b>æ‰‹å–ã‚Šåˆè¨ˆï¼šÂ¥${totalPay.toLocaleString()}</b>
  `;
}

function save() {
  const rows = [...document.querySelectorAll("#salaryTable tr")].slice(1);
  const data = rows.map(r => {
    const i = r.querySelectorAll("input");
    return {
      date: i[0].value,
      hours: i[1].value,
      wage: i[2].value,
      drink: i[3].value,
      inhouse: i[4].value,
      main: i[5].value,
      accompany: i[6].value,
      hair: i[7].checked,
      daily: i[8].checked
    };
  });
  localStorage.setItem("salaryData", JSON.stringify(data));
  calculate();
}

function load() {
  const data = JSON.parse(localStorage.getItem("salaryData") || "[]");
  data.forEach(d => addRow(d));
}

document.body.addEventListener("input", save);
load();
</script>

</body>
</html>
